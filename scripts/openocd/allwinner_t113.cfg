# SPDX-License-Identifier: GPL-2.0-or-later
# This is the config for an Allwinner T113 (sun8iw20).

adapter speed 4000

if { [info exists CHIPNAME] } {
	set  _CHIPNAME $CHIPNAME
} else {
	set  _CHIPNAME t113
}

if { [info exists DAP_TAPID] } {
	set _DAP_TAPID $DAP_TAPID
} else {
	set _DAP_TAPID 0x5ba00477
}

if { [info exists CHIPCORES] } {
	set _cores $CHIPCORES
} else {
	set _cores 2
}

if { [info exists USE_SMP] } {
	set _USE_SMP $USE_SMP
} else {
	set _USE_SMP 0
}

reset_config none srst_pulls_trst

jtag newtap $_CHIPNAME tap -irlen 4 -ircapture 0x1 -irmask 0x3 -expected-id $_DAP_TAPID -ignore-version
dap create $_CHIPNAME.dap -chain-position $_CHIPNAME.tap

set _smp_command ""

# Add Cortex A7 core
set _TARGETNAME $_CHIPNAME.cpu

for { set _core 0 } { $_core < $_cores } { incr _core 1 } {
	target create ${_TARGETNAME}$_core cortex_a -endian little \
						 -dap $_CHIPNAME.dap -coreid $_core

	if { $_core != 0 } {
		${_TARGETNAME}$_core configure -defer-examine
	}
	set _smp_command "$_smp_command ${_TARGETNAME}$_core"
}

if {$_USE_SMP} {
	eval $_smp_command
}

# default target is cpu0
targets $_CHIPNAME.cpu0

